@using SeasonOfGhosts.Components.Shared
@using SeasonOfGhosts.Core
@using SeasonOfGhosts.Core.Stats
@inherits UnitOfWorkComponentBase
@inject IDialogService DialogService

<MudItem xs="12" md="6">
    <MudCard>
        <MudCardContent>
            <MudGrid>
                <MudItem xs="7"><MudText Typo="Typo.subtitle1">@Stat.Name</MudText></MudItem>
                <MudItem xs="5"><MudButton Variant="Variant.Filled" OnClick="() => AdjustStat(Stat)">Adjust</MudButton></MudItem>
                <MudItem xs="6">Value: @Stat.Value</MudItem>
            </MudGrid>
        </MudCardContent>
    </MudCard>
</MudItem>

@code {
    [Parameter, EditorRequired]
    public required Stat Stat { get; set; }

    protected override async Task OnInitializedAsync()
    { 
        await base.OnInitializedAsync();
        Context.Attach(Stat);
    }

    private async Task AdjustStat(Stat stat)
    {
        var dialog = await DialogService.ShowAsync<AdjustSelect>();
        var result = await dialog.Result;

        if (result is not { Canceled: false })
        {
            return;
        }

        if (result.Data is not Adjustment adjustment)
        {
            return;
        }

        await stat.ChangeStatAsync(adjustment.Delta, adjustment.Reason, Context);
    }
}